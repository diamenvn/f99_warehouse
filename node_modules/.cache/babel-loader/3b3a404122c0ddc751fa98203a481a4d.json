{"ast":null,"code":"import _toConsumableArray from\"/Users/onion9x/Documents/Source Code/f99_warehouse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/onion9x/Documents/Source Code/f99_warehouse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/onion9x/Documents/Source Code/f99_warehouse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _createSuper from\"/Users/onion9x/Documents/Source Code/f99_warehouse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/Users/onion9x/Documents/Source Code/f99_warehouse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import Header from'./header';import Main from'./main';import Detail from'./detail';import'./style.sass';import{message,Button}from'antd';import{AppAPI}from'../../../api/appApi';var Analytics=/*#__PURE__*/function(_Component){_inherits(Analytics,_Component);var _super=_createSuper(Analytics);function Analytics(){var _this;_classCallCheck(this,Analytics);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={columnState:[{title:'#',width:90,dataIndex:'id',key:'id',fixed:'left'}],dataSource:[],loading:true,params:[],page:1,lastPage:1,currentPage:1,detailId:null,collection:[],visibleDetail:false,id:_this.props.match.params.id,filter:[],textFilterBy:[{text:'Tên khách hàng',key:'customer_name'},{text:'Số điện thoại',key:'customer_phone'},{text:'Mua theo sản phẩm',key:'products'},{text:'Số lần mua hàng',key:'count_buy'},{text:'Tỉnh thành, Quận huyện',key:'customer_address'},{text:'Công ty chi nhánh',key:'sale_branch'},{text:'Thời gian mua',key:'date'}]};_this.saveCollection=function(text){var params={'text':text,'filter':_this.state.params};AppAPI.saveCollection(params).then(function(res){var data=res.data;if(data.success){message.success(data.msg);}else{message.error(data.msg);}});};_this.updateDataTable=function(arrayFilter){var params=arrayFilter;document.querySelector('.ant-table-body').scrollTop=\"0px\";_this.setState(function(prevState){return{page:1,params:[].concat(_toConsumableArray(prevState.params),[params])};},function(){this.fetchListDataFromAPI(this.state.params);});};_this.fetchListDataFromAPI=function(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var append=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_this.setState({loading:true});var page=_this.state.page;AppAPI.getAllData(params,page).then(function(res){var data=res.data;var stt=0;if(append){if(data.success){data.data.rows.map(function(res){stt+=1;var obj=res;_this.setState(function(prevState){return{dataSource:[].concat(_toConsumableArray(prevState.dataSource),[obj])};});});}}else{_this.setState({dataSource:[]},function(){var _this2=this;if(data.success){data.data.rows.map(function(res){stt+=1;var obj=res;Object.assign(obj,{detail:/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return _this2.openDetail(true,res.id);},type:\"primary\"},\"Xem\")});_this2.setState(function(prevState){return{dataSource:[].concat(_toConsumableArray(prevState.dataSource),[obj])};});});}});}if(data.success){_this.setState(function(prevState){return{lastPage:data.data.last_page,currentPage:data.data.current_page};});}}).finally(function(res){_this.setState({loading:false});});};_this.fetchColumn=function(){AppAPI.getAllColumn().then(function(res){var data=res.data;var stt=0;if(data.success){data.data.map(function(res){var _res$width,_res$fixed;stt+=1;var obj={title:res.title,dataIndex:res.name,key:res.name,width:(_res$width=res.width)!==null&&_res$width!==void 0?_res$width:250,fixed:(_res$fixed=res.fixed)!==null&&_res$fixed!==void 0?_res$fixed:'none'};if(res.show||typeof res.show==\"undefined\"){_this.setState(function(prevState){return{columnState:[].concat(_toConsumableArray(prevState.columnState),[obj])};});}});_this.setState({columnState:[].concat(_toConsumableArray(_this.state.columnState),[{title:'Chi tiết',width:90,dataIndex:'detail',key:'detail',fixed:'right'}])});}else{message.error(data.msg);}return true;});};_this.loadMoreData=function(){var tableContent=document.querySelector('.ant-table-body');tableContent.addEventListener('scroll',function(event){var maxScroll=event.target.scrollHeight-event.target.clientHeight;var currentScroll=event.target.scrollTop;if(currentScroll===maxScroll&&_this.state.currentPage<_this.state.lastPage){_this.setState({loading:true,page:_this.state.page+1},function(){this.fetchListDataFromAPI(this.state.params,true);});}});};_this.getCollection=function(){AppAPI.getCollection().then(function(res){var data=res.data;if(data.success){_this.setState({collection:data.data});}});};_this.detailCollection=function(){if(!!_this.state.id){AppAPI.getDetailCollection(_this.state.id).then(function(res){var data=res.data;var obj;var arr=[];if(data.success){data.data.filter.map(function(res){var filterIs=res[1].replace(\"is\",'là').replace('equal','có chứa').replace('start','bắt đầu là').replace('end','kết thúc là');_this.state.textFilterBy.map(function(item){if(item.key==res[0]){obj={'text':item.text+\" \"+filterIs+\" \"+res[2]};arr.push(obj);}});});_this.setState({filter:arr,params:data.data.filter},_this.fetchListDataFromAPI(data.data.filter));}});}else{_this.fetchListDataFromAPI();}};_this.updateFilter=function(obj){_this.setState(function(prevState){return{filter:[].concat(_toConsumableArray(prevState.filter),[obj])};});};_this.openDetail=function(bool,id){_this.setState({visibleDetail:bool,detailId:id});};_this.hideDetail=function(){_this.setState({visibleDetail:false});};return _this;}_createClass(Analytics,[{key:\"componentDidMount\",value:function componentDidMount(){this.fetchColumn();this.loadMoreData();this.getCollection();this.detailCollection();}},{key:\"render\",value:function render(){var _this$state=this.state,loading=_this$state.loading,dataSource=_this$state.dataSource,columnState=_this$state.columnState,textFilterBy=_this$state.textFilterBy,filter=_this$state.filter;return/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-column h-100\"},/*#__PURE__*/React.createElement(Header,{updateFilter:this.updateFilter,filter:filter,textFilterBy:textFilterBy,updateDataTable:this.updateDataTable}),/*#__PURE__*/React.createElement(Main,{collection:this.state.collection,loading:loading,saveCollection:this.saveCollection,dataSource:dataSource,columnState:columnState}),/*#__PURE__*/React.createElement(Detail,{id:this.state.detailId,hideDetail:this.hideDetail,visibleDetail:this.state.visibleDetail}));}}]);return Analytics;}(Component);export default Analytics;","map":{"version":3,"sources":["/Users/onion9x/Documents/Source Code/f99_warehouse/src/components/site/datatable/index.js"],"names":["React","Component","Header","Main","Detail","message","Button","AppAPI","Analytics","state","columnState","title","width","dataIndex","key","fixed","dataSource","loading","params","page","lastPage","currentPage","detailId","collection","visibleDetail","id","props","match","filter","textFilterBy","text","saveCollection","then","res","data","success","msg","error","updateDataTable","arrayFilter","document","querySelector","scrollTop","setState","prevState","fetchListDataFromAPI","append","getAllData","stt","rows","map","obj","Object","assign","detail","e","openDetail","last_page","current_page","finally","fetchColumn","getAllColumn","name","show","loadMoreData","tableContent","addEventListener","event","maxScroll","target","scrollHeight","clientHeight","currentScroll","getCollection","detailCollection","getDetailCollection","arr","filterIs","replace","item","push","updateFilter","bool","hideDetail"],"mappings":"q0BAAA,MAAOA,CAAAA,KAAP,EACIC,SADJ,KAEO,OAFP,CAGA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAO,cAAP,CACA,OAASC,OAAT,CAAkBC,MAAlB,KAAgC,MAAhC,CACA,OAASC,MAAT,KAAuB,qBAAvB,C,GAEMC,CAAAA,S,uUACFC,K,CAAQ,CACJC,WAAW,CAAE,CAAC,CACVC,KAAK,CAAE,GADG,CAEVC,KAAK,CAAE,EAFG,CAGVC,SAAS,CAAE,IAHD,CAIVC,GAAG,CAAE,IAJK,CAKVC,KAAK,CAAE,MALG,CAAD,CADT,CAQJC,UAAU,CAAE,EARR,CASJC,OAAO,CAAE,IATL,CAUJC,MAAM,CAAE,EAVJ,CAWJC,IAAI,CAAE,CAXF,CAYJC,QAAQ,CAAE,CAZN,CAaJC,WAAW,CAAE,CAbT,CAcJC,QAAQ,CAAE,IAdN,CAeJC,UAAU,CAAE,EAfR,CAgBJC,aAAa,CAAE,KAhBX,CAiBJC,EAAE,CAAE,MAAKC,KAAL,CAAWC,KAAX,CAAiBT,MAAjB,CAAwBO,EAjBxB,CAkBJG,MAAM,CAAE,EAlBJ,CAmBJC,YAAY,CAAE,CACV,CAAEC,IAAI,CAAE,gBAAR,CAA0BhB,GAAG,CAAE,eAA/B,CADU,CAEV,CAAEgB,IAAI,CAAE,eAAR,CAAyBhB,GAAG,CAAE,gBAA9B,CAFU,CAGV,CAAEgB,IAAI,CAAE,mBAAR,CAA6BhB,GAAG,CAAE,UAAlC,CAHU,CAIV,CAAEgB,IAAI,CAAE,iBAAR,CAA2BhB,GAAG,CAAE,WAAhC,CAJU,CAKV,CAAEgB,IAAI,CAAE,wBAAR,CAAkChB,GAAG,CAAE,kBAAvC,CALU,CAMV,CAAEgB,IAAI,CAAE,mBAAR,CAA6BhB,GAAG,CAAE,aAAlC,CANU,CAOV,CAAEgB,IAAI,CAAE,eAAR,CAAyBhB,GAAG,CAAE,MAA9B,CAPU,CAnBV,C,OAgDRiB,c,CAAiB,SAACD,IAAD,CAAU,CACvB,GAAIZ,CAAAA,MAAM,CAAG,CACT,OAAQY,IADC,CAET,SAAU,MAAKrB,KAAL,CAAWS,MAFZ,CAAb,CAIAX,MAAM,CAACwB,cAAP,CAAsBb,MAAtB,EAA8Bc,IAA9B,CAAmC,SAAAC,GAAG,CAAI,IAC9BC,CAAAA,IAD8B,CACrBD,GADqB,CAC9BC,IAD8B,CAEtC,GAAIA,IAAI,CAACC,OAAT,CAAkB,CACd9B,OAAO,CAAC8B,OAAR,CAAgBD,IAAI,CAACE,GAArB,EACH,CAFD,IAEK,CACD/B,OAAO,CAACgC,KAAR,CAAcH,IAAI,CAACE,GAAnB,EACH,CACJ,CAPD,EAQH,C,OAEDE,e,CAAkB,SAACC,WAAD,CAAiB,CAC/B,GAAIrB,CAAAA,MAAM,CAAGqB,WAAb,CACAC,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,EAA0CC,SAA1C,CAAsD,KAAtD,CACA,MAAKC,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxBzB,IAAI,CAAE,CADkB,CAExBD,MAAM,8BAAM0B,SAAS,CAAC1B,MAAhB,GAAwBA,MAAxB,EAFkB,CAAL,EAAvB,CAGI,UAAY,CACZ,KAAK2B,oBAAL,CAA0B,KAAKpC,KAAL,CAAWS,MAArC,EACH,CALD,EAMH,C,OAED2B,oB,CAAuB,UAAiC,IAAhC3B,CAAAA,MAAgC,2DAAvB,EAAuB,IAAnB4B,CAAAA,MAAmB,2DAAV,KAAU,CACpD,MAAKH,QAAL,CAAc,CAAE1B,OAAO,CAAE,IAAX,CAAd,EACA,GAAIE,CAAAA,IAAI,CAAG,MAAKV,KAAL,CAAWU,IAAtB,CACAZ,MAAM,CAACwC,UAAP,CAAkB7B,MAAlB,CAA0BC,IAA1B,EAAgCa,IAAhC,CAAqC,SAAAC,GAAG,CAAI,IAChCC,CAAAA,IADgC,CACvBD,GADuB,CAChCC,IADgC,CAExC,GAAIc,CAAAA,GAAG,CAAG,CAAV,CACA,GAAIF,MAAJ,CAAY,CACR,GAAIZ,IAAI,CAACC,OAAT,CAAkB,CACdD,IAAI,CAACA,IAAL,CAAUe,IAAV,CAAeC,GAAf,CAAmB,SAAAjB,GAAG,CAAI,CACtBe,GAAG,EAAI,CAAP,CACA,GAAIG,CAAAA,GAAG,CAAGlB,GAAV,CACA,MAAKU,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxB5B,UAAU,8BAAM4B,SAAS,CAAC5B,UAAhB,GAA4BmC,GAA5B,EADc,CAAL,EAAvB,EAGH,CAND,EAOH,CACJ,CAVD,IAUK,CACD,MAAKR,QAAL,CAAc,CACV3B,UAAU,CAAE,EADF,CAAd,CAEG,UAAY,iBACX,GAAIkB,IAAI,CAACC,OAAT,CAAkB,CACdD,IAAI,CAACA,IAAL,CAAUe,IAAV,CAAeC,GAAf,CAAmB,SAAAjB,GAAG,CAAI,CACtBe,GAAG,EAAI,CAAP,CACA,GAAIG,CAAAA,GAAG,CAAGlB,GAAV,CACAmB,MAAM,CAACC,MAAP,CAAcF,GAAd,CAAmB,CAACG,MAAM,cAAE,oBAAC,MAAD,EAAQ,OAAO,CAAE,iBAAAC,CAAC,QAAI,CAAA,MAAI,CAACC,UAAL,CAAgB,IAAhB,CAAsBvB,GAAG,CAACR,EAA1B,CAAJ,EAAlB,CAAqD,IAAI,CAAC,SAA1D,QAAT,CAAnB,EACA,MAAI,CAACkB,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxB5B,UAAU,8BAAM4B,SAAS,CAAC5B,UAAhB,GAA4BmC,GAA5B,EADc,CAAL,EAAvB,EAGH,CAPD,EAQH,CACJ,CAbD,EAcH,CAED,GAAIjB,IAAI,CAACC,OAAT,CAAkB,CACd,MAAKQ,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxBxB,QAAQ,CAAEc,IAAI,CAACA,IAAL,CAAUuB,SADI,CAExBpC,WAAW,CAAEa,IAAI,CAACA,IAAL,CAAUwB,YAFC,CAAL,EAAvB,EAIH,CAGJ,CAtCD,EAsCGC,OAtCH,CAsCW,SAAA1B,GAAG,CAAI,CACd,MAAKU,QAAL,CAAc,CAAE1B,OAAO,CAAE,KAAX,CAAd,EACH,CAxCD,EAyCH,C,OAED2C,W,CAAc,UAAM,CAChBrD,MAAM,CAACsD,YAAP,GAAsB7B,IAAtB,CAA2B,SAAAC,GAAG,CAAI,IACtBC,CAAAA,IADsB,CACbD,GADa,CACtBC,IADsB,CAE9B,GAAIc,CAAAA,GAAG,CAAG,CAAV,CACA,GAAId,IAAI,CAACC,OAAT,CAAkB,CACdD,IAAI,CAACA,IAAL,CAAUgB,GAAV,CAAc,SAAAjB,GAAG,CAAI,2BACjBe,GAAG,EAAI,CAAP,CAEA,GAAMG,CAAAA,GAAG,CAAG,CACRxC,KAAK,CAAEsB,GAAG,CAACtB,KADH,CAERE,SAAS,CAAEoB,GAAG,CAAC6B,IAFP,CAGRhD,GAAG,CAAEmB,GAAG,CAAC6B,IAHD,CAIRlD,KAAK,aAAEqB,GAAG,CAACrB,KAAN,yCAAe,GAJZ,CAKRG,KAAK,aAAEkB,GAAG,CAAClB,KAAN,yCAAe,MALZ,CAAZ,CAQA,GAAIkB,GAAG,CAAC8B,IAAJ,EAAY,MAAO9B,CAAAA,GAAG,CAAC8B,IAAX,EAAmB,WAAnC,CAAgD,CAC5C,MAAKpB,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxBlC,WAAW,8BAAMkC,SAAS,CAAClC,WAAhB,GAA6ByC,GAA7B,EADa,CAAL,EAAvB,EAGH,CAEJ,CAjBD,EAmBA,MAAKR,QAAL,CAAc,CACVjC,WAAW,8BAAM,MAAKD,KAAL,CAAWC,WAAjB,GAA8B,CACrCC,KAAK,CAAE,UAD8B,CAErCC,KAAK,CAAE,EAF8B,CAGrCC,SAAS,CAAE,QAH0B,CAIrCC,GAAG,CAAE,QAJgC,CAKrCC,KAAK,CAAE,OAL8B,CAA9B,EADD,CAAd,EASH,CA7BD,IA6BO,CACHV,OAAO,CAACgC,KAAR,CAAcH,IAAI,CAACE,GAAnB,EACH,CACD,MAAO,KAAP,CACH,CApCD,EAqCH,C,OAED4B,Y,CAAe,UAAM,CACjB,GAAIC,CAAAA,YAAY,CAAGzB,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAnB,CACAwB,YAAY,CAACC,gBAAb,CAA8B,QAA9B,CAAwC,SAACC,KAAD,CAAW,CAC/C,GAAIC,CAAAA,SAAS,CAAGD,KAAK,CAACE,MAAN,CAAaC,YAAb,CAA4BH,KAAK,CAACE,MAAN,CAAaE,YAAzD,CACA,GAAIC,CAAAA,aAAa,CAAGL,KAAK,CAACE,MAAN,CAAa3B,SAAjC,CACA,GAAI8B,aAAa,GAAKJ,SAAlB,EAA+B,MAAK3D,KAAL,CAAWY,WAAX,CAAyB,MAAKZ,KAAL,CAAWW,QAAvE,CAAiF,CAC7E,MAAKuB,QAAL,CAAc,CACV1B,OAAO,CAAE,IADC,CAEVE,IAAI,CAAE,MAAKV,KAAL,CAAWU,IAAX,CAAkB,CAFd,CAAd,CAGG,UAAW,CACV,KAAK0B,oBAAL,CAA0B,KAAKpC,KAAL,CAAWS,MAArC,CAA6C,IAA7C,EACH,CALD,EAMH,CACJ,CAXD,EAYH,C,OAEDuD,a,CAAgB,UAAM,CAClBlE,MAAM,CAACkE,aAAP,GAAuBzC,IAAvB,CAA4B,SAAAC,GAAG,CAAI,IACvBC,CAAAA,IADuB,CACdD,GADc,CACvBC,IADuB,CAE/B,GAAIA,IAAI,CAACC,OAAT,CAAkB,CACd,MAAKQ,QAAL,CAAc,CACVpB,UAAU,CAAEW,IAAI,CAACA,IADP,CAAd,EAGH,CACJ,CAPD,EAQH,C,OAEDwC,gB,CAAmB,UAAM,CACrB,GAAI,CAAC,CAAC,MAAKjE,KAAL,CAAWgB,EAAjB,CAAqB,CACjBlB,MAAM,CAACoE,mBAAP,CAA2B,MAAKlE,KAAL,CAAWgB,EAAtC,EAA0CO,IAA1C,CAA+C,SAAAC,GAAG,CAAI,IAC1CC,CAAAA,IAD0C,CACjCD,GADiC,CAC1CC,IAD0C,CAElD,GAAIiB,CAAAA,GAAJ,CAAQ,GAAIyB,CAAAA,GAAG,CAAG,EAAV,CAER,GAAI1C,IAAI,CAACC,OAAT,CAAkB,CACdD,IAAI,CAACA,IAAL,CAAUN,MAAV,CAAiBsB,GAAjB,CAAqB,SAAAjB,GAAG,CAAI,CACxB,GAAI4C,CAAAA,QAAQ,CAAG5C,GAAG,CAAC,CAAD,CAAH,CAAO6C,OAAP,CAAe,IAAf,CAAqB,IAArB,EAA2BA,OAA3B,CAAmC,OAAnC,CAA4C,SAA5C,EAAuDA,OAAvD,CAA+D,OAA/D,CAAwE,YAAxE,EAAsFA,OAAtF,CAA8F,KAA9F,CAAqG,aAArG,CAAf,CAEA,MAAKrE,KAAL,CAAWoB,YAAX,CAAwBqB,GAAxB,CAA4B,SAAA6B,IAAI,CAAI,CAChC,GAAIA,IAAI,CAACjE,GAAL,EAAYmB,GAAG,CAAC,CAAD,CAAnB,CAAwB,CACpBkB,GAAG,CAAG,CAAC,OAAQ4B,IAAI,CAACjD,IAAL,CAAY,GAAZ,CAAiB+C,QAAjB,CAA4B,GAA5B,CAAkC5C,GAAG,CAAC,CAAD,CAA9C,CAAN,CACA2C,GAAG,CAACI,IAAJ,CAAS7B,GAAT,EACH,CACJ,CALD,EAMH,CATD,EAUA,MAAKR,QAAL,CAAc,CACVf,MAAM,CAAEgD,GADE,CAEV1D,MAAM,CAAEgB,IAAI,CAACA,IAAL,CAAUN,MAFR,CAAd,CAGG,MAAKiB,oBAAL,CAA0BX,IAAI,CAACA,IAAL,CAAUN,MAApC,CAHH,EAIH,CACJ,CApBD,EAqBH,CAtBD,IAsBK,CACD,MAAKiB,oBAAL,GACH,CACJ,C,OAEDoC,Y,CAAe,SAAC9B,GAAD,CAAS,CACpB,MAAKR,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxBhB,MAAM,8BAAMgB,SAAS,CAAChB,MAAhB,GAAwBuB,GAAxB,EADkB,CAAL,EAAvB,EAGH,C,OAEDK,U,CAAa,SAAC0B,IAAD,CAAOzD,EAAP,CAAc,CACvB,MAAKkB,QAAL,CAAc,CACVnB,aAAa,CAAE0D,IADL,CAEV5D,QAAQ,CAAEG,EAFA,CAAd,EAIH,C,OAED0D,U,CAAa,UAAM,CACf,MAAKxC,QAAL,CAAc,CACVnB,aAAa,CAAE,KADL,CAAd,EAGH,C,kGA1MmB,CAChB,KAAKoC,WAAL,GACA,KAAKI,YAAL,GACA,KAAKS,aAAL,GACA,KAAKC,gBAAL,GACH,C,uCAEQ,iBAC4D,KAAKjE,KADjE,CACCQ,OADD,aACCA,OADD,CACUD,UADV,aACUA,UADV,CACsBN,WADtB,aACsBA,WADtB,CACmCmB,YADnC,aACmCA,YADnC,CACiDD,MADjD,aACiDA,MADjD,CAEL,mBACI,2BAAK,SAAS,CAAC,0BAAf,eACI,oBAAC,MAAD,EAAQ,YAAY,CAAE,KAAKqD,YAA3B,CAAyC,MAAM,CAAErD,MAAjD,CAAyD,YAAY,CAAEC,YAAvE,CAAqF,eAAe,CAAE,KAAKS,eAA3G,EADJ,cAEI,oBAAC,IAAD,EAAM,UAAU,CAAE,KAAK7B,KAAL,CAAWc,UAA7B,CAAyC,OAAO,CAAEN,OAAlD,CAA2D,cAAc,CAAE,KAAKc,cAAhF,CAAgG,UAAU,CAAEf,UAA5G,CAAwH,WAAW,CAAEN,WAArI,EAFJ,cAGI,oBAAC,MAAD,EAAQ,EAAE,CAAE,KAAKD,KAAL,CAAWa,QAAvB,CAAiC,UAAU,CAAE,KAAK6D,UAAlD,CAA8D,aAAa,CAAE,KAAK1E,KAAL,CAAWe,aAAxF,EAHJ,CADJ,CAOH,C,uBA/CmBvB,S,EA6OxB,cAAeO,CAAAA,SAAf","sourcesContent":["import React, {\n    Component\n} from 'react';\nimport Header from './header';\nimport Main from './main';\nimport Detail from './detail';\nimport './style.sass';\nimport { message, Button } from 'antd';\nimport { AppAPI } from '../../../api/appApi';\n\nclass Analytics extends Component {\n    state = {\n        columnState: [{\n            title: '#',\n            width: 90,\n            dataIndex: 'id',\n            key: 'id',\n            fixed: 'left',\n        }],\n        dataSource: [],\n        loading: true,\n        params: [],\n        page: 1,\n        lastPage: 1,\n        currentPage: 1,\n        detailId: null,\n        collection: [],\n        visibleDetail: false,\n        id: this.props.match.params.id,\n        filter: [],\n        textFilterBy: [\n            { text: 'Tên khách hàng', key: 'customer_name' },\n            { text: 'Số điện thoại', key: 'customer_phone' },\n            { text: 'Mua theo sản phẩm', key: 'products' },\n            { text: 'Số lần mua hàng', key: 'count_buy' },\n            { text: 'Tỉnh thành, Quận huyện', key: 'customer_address' },\n            { text: 'Công ty chi nhánh', key: 'sale_branch' },\n            { text: 'Thời gian mua', key: 'date' },\n        ],\n    }\n\n    componentDidMount() {\n        this.fetchColumn();\n        this.loadMoreData();\n        this.getCollection();\n        this.detailCollection();\n    }\n\n    render() {\n        let { loading, dataSource, columnState, textFilterBy, filter } = this.state;\n        return (\n            <div className=\"d-flex flex-column h-100\">\n                <Header updateFilter={this.updateFilter} filter={filter} textFilterBy={textFilterBy} updateDataTable={this.updateDataTable} />\n                <Main collection={this.state.collection} loading={loading} saveCollection={this.saveCollection} dataSource={dataSource} columnState={columnState} />\n                <Detail id={this.state.detailId} hideDetail={this.hideDetail} visibleDetail={this.state.visibleDetail} />\n            </div>\n        );\n    }\n\n    saveCollection = (text) => {\n        let params = {\n            'text': text,\n            'filter': this.state.params\n        };\n        AppAPI.saveCollection(params).then(res => {\n            const { data } = res;\n            if (data.success) {\n                message.success(data.msg);\n            }else{\n                message.error(data.msg);\n            }\n        });\n    }\n\n    updateDataTable = (arrayFilter) => {\n        let params = arrayFilter;\n        document.querySelector('.ant-table-body').scrollTop = \"0px\";\n        this.setState(prevState => ({\n            page: 1,\n            params: [...prevState.params, params]\n        }), function () {\n            this.fetchListDataFromAPI(this.state.params);\n        });\n    }\n\n    fetchListDataFromAPI = (params = '', append = false) => {\n        this.setState({ loading: true });\n        let page = this.state.page;\n        AppAPI.getAllData(params, page).then(res => {\n            const { data } = res;\n            var stt = 0;\n            if (append) {\n                if (data.success) {\n                    data.data.rows.map(res => {\n                        stt += 1;\n                        let obj = res;\n                        this.setState(prevState => ({\n                            dataSource: [...prevState.dataSource, obj]\n                        }));\n                    });\n                }\n            }else{\n                this.setState({\n                    dataSource: []\n                }, function () {\n                    if (data.success) {\n                        data.data.rows.map(res => {\n                            stt += 1;\n                            let obj = res;\n                            Object.assign(obj, {detail: <Button onClick={e => this.openDetail(true, res.id)} type=\"primary\">Xem</Button>})\n                            this.setState(prevState => ({\n                                dataSource: [...prevState.dataSource, obj]\n                            }));\n                        });\n                    }\n                });\n            }\n\n            if (data.success) {\n                this.setState(prevState => ({\n                    lastPage: data.data.last_page,\n                    currentPage: data.data.current_page\n                }));\n            }\n            \n\n        }).finally(res => {\n            this.setState({ loading: false });\n        })\n    }\n\n    fetchColumn = () => {\n        AppAPI.getAllColumn().then(res => {\n            const { data } = res;\n            var stt = 0;\n            if (data.success) {\n                data.data.map(res => {\n                    stt += 1;\n\n                    const obj = {\n                        title: res.title,\n                        dataIndex: res.name,\n                        key: res.name,\n                        width: res.width ?? 250,\n                        fixed: res.fixed ?? 'none'\n                    };\n\n                    if (res.show || typeof res.show == \"undefined\") {\n                        this.setState(prevState => ({\n                            columnState: [...prevState.columnState, obj]\n                        }));\n                    }\n\n                });\n\n                this.setState({\n                    columnState: [...this.state.columnState, {\n                        title: 'Chi tiết',\n                        width: 90,\n                        dataIndex: 'detail',\n                        key: 'detail',\n                        fixed: 'right'\n                    }]\n                });\n            } else {\n                message.error(data.msg);\n            }\n            return true;\n        });\n    }\n\n    loadMoreData = () => {\n        var tableContent = document.querySelector('.ant-table-body')\n        tableContent.addEventListener('scroll', (event) => {\n            let maxScroll = event.target.scrollHeight - event.target.clientHeight\n            let currentScroll = event.target.scrollTop\n            if (currentScroll === maxScroll && this.state.currentPage < this.state.lastPage) {\n                this.setState({\n                    loading: true,\n                    page: this.state.page + 1\n                }, function() { \n                    this.fetchListDataFromAPI(this.state.params, true)\n                });\n            }\n        })\n    }\n\n    getCollection = () => {\n        AppAPI.getCollection().then(res => {\n            const { data } = res;\n            if (data.success) {\n                this.setState({\n                    collection: data.data\n                });\n            }\n        });\n    }\n\n    detailCollection = () => {\n        if (!!this.state.id) {\n            AppAPI.getDetailCollection(this.state.id).then(res => {\n                const { data } = res;\n                let obj;let arr = [];\n\n                if (data.success) {\n                    data.data.filter.map(res => {\n                        let filterIs = res[1].replace(\"is\", 'là').replace('equal', 'có chứa').replace('start', 'bắt đầu là').replace('end', 'kết thúc là');\n\n                        this.state.textFilterBy.map(item => {\n                            if (item.key == res[0]) {\n                                obj = {'text': item.text + \" \" +filterIs + \" \" + res[2]};\n                                arr.push(obj);\n                            }\n                        });\n                    });\n                    this.setState({\n                        filter: arr,\n                        params: data.data.filter\n                    }, this.fetchListDataFromAPI(data.data.filter));\n                }\n            });\n        }else{\n            this.fetchListDataFromAPI();\n        }\n    }\n\n    updateFilter = (obj) => {\n        this.setState(prevState => ({\n            filter: [...prevState.filter, obj]\n        }));\n    }\n\n    openDetail = (bool, id) => {\n        this.setState({\n            visibleDetail: bool,\n            detailId: id\n        });\n    }\n\n    hideDetail = () => {\n        this.setState({\n            visibleDetail: false\n        });\n    }\n\n}\n\nexport default Analytics;"]},"metadata":{},"sourceType":"module"}