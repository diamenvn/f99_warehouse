{"ast":null,"code":"var _jsxFileName = \"/Users/onion9x/Documents/Source Code/f99_warehouse/src/components/site/datatable/index.js\";\nimport React, { Component } from 'react';\nimport Header from './header';\nimport Main from './main';\nimport './style.sass';\nimport { message, Button } from 'antd';\nimport { AppAPI } from '../../../api/appApi';\n\nclass Analytics extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      columnState: [{\n        title: '#',\n        width: 90,\n        dataIndex: 'id',\n        key: 'id',\n        fixed: 'left'\n      }],\n      dataSource: [],\n      loading: true,\n      params: [],\n      page: 1\n    };\n\n    this.updateDataTable = arrayFilter => {\n      let params = arrayFilter;\n      document.querySelector('.ant-table-body').scrollTop = \"0px\";\n      this.setState(prevState => ({\n        page: 1,\n        params: [...prevState.params, params]\n      }), function () {\n        this.fetchListDataFromAPI(this.state.params);\n      });\n    };\n\n    this.fetchListDataFromAPI = (params = '', append = false) => {\n      this.setState({\n        loading: true\n      });\n      let page = this.state.page;\n      AppAPI.getAllData(params, page).then(res => {\n        const {\n          data\n        } = res;\n        var stt = 0;\n\n        if (append) {\n          if (data.success) {\n            data.data.map(res => {\n              stt += 1;\n              let obj = res;\n              this.setState(prevState => ({\n                dataSource: [...prevState.dataSource, obj]\n              }));\n            });\n          }\n        } else {\n          this.setState({\n            dataSource: []\n          }, function () {\n            if (data.success) {\n              data.data.map(res => {\n                stt += 1;\n                let obj = res;\n                this.setState(prevState => ({\n                  dataSource: [...prevState.dataSource, obj]\n                }));\n              });\n            }\n          });\n        }\n      }).finally(res => {\n        this.setState({\n          loading: false\n        });\n      });\n    };\n\n    this.fetchColumn = () => {\n      AppAPI.getAllColumn().then(res => {\n        const {\n          data\n        } = res;\n        var stt = 0;\n\n        if (data.success) {\n          data.data.map(res => {\n            var _res$width, _res$fixed;\n\n            stt += 1;\n            const obj = {\n              title: res.title,\n              dataIndex: res.name,\n              key: res.name,\n              width: (_res$width = res.width) !== null && _res$width !== void 0 ? _res$width : 250,\n              fixed: (_res$fixed = res.fixed) !== null && _res$fixed !== void 0 ? _res$fixed : 'none'\n            };\n\n            if (res.show || typeof res.show == \"undefined\") {\n              this.setState(prevState => ({\n                columnState: [...prevState.columnState, obj]\n              }));\n            }\n          });\n          this.setState({\n            columnState: [...this.state.columnState, {\n              title: 'Chi tiết',\n              width: 90,\n              dataIndex: 'detail',\n              key: 'detail',\n              fixed: 'right',\n              render: () => /*#__PURE__*/React.createElement(Button, {\n                type: \"primary\",\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 121,\n                  columnNumber: 39\n                }\n              }, \"Xem\")\n            }]\n          });\n        } else {\n          message.error(data.msg);\n        }\n\n        return true;\n      });\n    };\n\n    this.loadMoreData = () => {\n      var tableContent = document.querySelector('.ant-table-body');\n      tableContent.addEventListener('scroll', event => {\n        if (event.target.scrollHeight < window.clientHeight) return;\n        let maxScroll = event.target.scrollHeight - event.target.clientHeight;\n        let currentScroll = event.target.scrollTop;\n\n        if (currentScroll === maxScroll) {\n          this.setState({\n            loading: true,\n            page: this.state.page + 1\n          }, function () {\n            this.fetchListDataFromAPI(this.state.params, true);\n          });\n        }\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.fetchListDataFromAPI();\n    this.fetchColumn();\n    this.loadMoreData();\n  }\n\n  render() {\n    let {\n      loading,\n      dataSource,\n      columnState\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex flex-column h-100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      updateDataTable: this.updateDataTable,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Main, {\n      loading: loading,\n      dataSource: dataSource,\n      columnState: columnState,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nexport default Analytics;","map":{"version":3,"sources":["/Users/onion9x/Documents/Source Code/f99_warehouse/src/components/site/datatable/index.js"],"names":["React","Component","Header","Main","message","Button","AppAPI","Analytics","state","columnState","title","width","dataIndex","key","fixed","dataSource","loading","params","page","updateDataTable","arrayFilter","document","querySelector","scrollTop","setState","prevState","fetchListDataFromAPI","append","getAllData","then","res","data","stt","success","map","obj","finally","fetchColumn","getAllColumn","name","show","render","error","msg","loadMoreData","tableContent","addEventListener","event","target","scrollHeight","window","clientHeight","maxScroll","currentScroll","componentDidMount"],"mappings":"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","sourcesContent":["import React, {\n    Component\n} from 'react';\nimport Header from './header';\nimport Main from './main';\nimport './style.sass';\nimport { message, Button } from 'antd';\nimport { AppAPI } from '../../../api/appApi';\n\nclass Analytics extends Component {\n    state = {\n        columnState: [{\n            title: '#',\n            width: 90,\n            dataIndex: 'id',\n            key: 'id',\n            fixed: 'left',\n        }],\n        dataSource: [],\n        loading: true,\n        params: [],\n        page: 1\n    }\n\n    componentDidMount() {\n        this.fetchListDataFromAPI();\n        this.fetchColumn();\n        this.loadMoreData();\n    }\n\n    render() {\n        let { loading, dataSource, columnState } = this.state;\n        return (\n            <div className=\"d-flex flex-column h-100\">\n                <Header updateDataTable={this.updateDataTable} />\n                <Main loading={loading} dataSource={dataSource} columnState={columnState} />\n            </div>\n        );\n    }\n\n    updateDataTable = (arrayFilter) => {\n        let params = arrayFilter;\n        document.querySelector('.ant-table-body').scrollTop = \"0px\";\n        this.setState(prevState => ({\n            page: 1,\n            params: [...prevState.params, params]\n        }), function () {\n            this.fetchListDataFromAPI(this.state.params);\n        });\n    }\n\n    fetchListDataFromAPI = (params = '', append = false) => {\n        this.setState({ loading: true });\n        let page = this.state.page;\n        AppAPI.getAllData(params, page).then(res => {\n            const { data } = res;\n            var stt = 0;\n            if (append) {\n                if (data.success) {\n                    data.data.map(res => {\n                        stt += 1;\n                        let obj = res;\n                        this.setState(prevState => ({\n                            dataSource: [...prevState.dataSource, obj]\n                        }));\n                    });\n                }\n            }else{\n                this.setState({\n                    dataSource: []\n                }, function () {\n                    if (data.success) {\n                        data.data.map(res => {\n                            stt += 1;\n                            let obj = res;\n                            this.setState(prevState => ({\n                                dataSource: [...prevState.dataSource, obj]\n                            }));\n                        });\n                    }\n                });\n            }\n            \n\n        }).finally(res => {\n            this.setState({ loading: false });\n        })\n    }\n\n    fetchColumn = () => {\n        AppAPI.getAllColumn().then(res => {\n            const { data } = res;\n            var stt = 0;\n            if (data.success) {\n                data.data.map(res => {\n                    stt += 1;\n\n                    const obj = {\n                        title: res.title,\n                        dataIndex: res.name,\n                        key: res.name,\n                        width: res.width ?? 250,\n                        fixed: res.fixed ?? 'none'\n                    };\n\n                    if (res.show || typeof res.show == \"undefined\") {\n                        this.setState(prevState => ({\n                            columnState: [...prevState.columnState, obj]\n                        }));\n                    }\n\n                });\n\n                this.setState({\n                    columnState: [...this.state.columnState, {\n                        title: 'Chi tiết',\n                        width: 90,\n                        dataIndex: 'detail',\n                        key: 'detail',\n                        fixed: 'right',\n                        render: () => <Button type=\"primary\">Xem</Button>,\n                    }]\n                });\n            } else {\n                message.error(data.msg);\n            }\n            return true;\n        });\n    }\n\n    loadMoreData = () => {\n        var tableContent = document.querySelector('.ant-table-body')\n        tableContent.addEventListener('scroll', (event) => {\n            if (event.target.scrollHeight < window.clientHeight) return;\n            let maxScroll = event.target.scrollHeight - event.target.clientHeight\n            let currentScroll = event.target.scrollTop\n            if (currentScroll === maxScroll) {\n                this.setState({\n                    loading: true,\n                    page: this.state.page + 1\n                }, function() { \n                    this.fetchListDataFromAPI(this.state.params, true)\n                });\n            }\n        })\n    }\n}\n\nexport default Analytics;"]},"metadata":{},"sourceType":"module"}